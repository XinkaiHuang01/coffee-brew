<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Brew - å’–å•¡å†²æ³¡è®°å½•</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&family=Noto+Serif+SC:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">â˜•</div>
                <span class="logo-text">Coffee Brew</span>
            </div>
            <div id="notion-sync-section" class="notion-sync-section">
                <label class="notion-toggle-label">
                    <input type="checkbox" id="notion-toggle">
                    <span class="notion-toggle-switch"></span>
                    <span>Notion åŒæ­¥</span>
                </label>
                <div id="sync-indicator" class="sync-indicator">â—‹ ç¦»çº¿</div>
                <button class="notion-config-btn" id="btn-open-config" title="é…ç½® Notion">âš™ï¸</button>
            </div>
            <nav class="nav">
                <a href="javascript:void(0)" class="nav-item active" data-page="home">
                    <span class="nav-icon">ğŸ </span>
                    <span>é¦–é¡µ</span>
                </a>
                <a href="javascript:void(0)" class="nav-item" data-page="recommendations">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>æ¨èå‚æ•°</span>
                </a>
                <a href="javascript:void(0)" class="nav-item" data-page="timer">
                    <span class="nav-icon">â±ï¸</span>
                    <span>å†²æ³¡è®¡æ—¶å™¨</span>
                </a>
                <a href="javascript:void(0)" class="nav-item" data-page="records">
                    <span class="nav-icon">ğŸ““</span>
                    <span>æˆ‘çš„è®°å½•</span>
                </a>
            </nav>
        </aside>

        <main class="main">
            <div class="page active" id="page-home">
                <div class="page-header">
                    <h1 class="page-title">æ¬¢è¿å›æ¥</h1>
                    <p class="page-subtitle">è®°å½•ä½ çš„æ¯ä¸€æ¯å¥½å’–å•¡</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">ç´¯è®¡å†²æ³¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-favorite">-</div>
                        <div class="stat-label">æœ€å¸¸ç”¨æ–¹æ³•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-rating">-</div>
                        <div class="stat-label">å¹³å‡è¯„åˆ†</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-week">0</div>
                        <div class="stat-label">æœ¬å‘¨å†²æ³¡</div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2 class="page-title dashboard-title">å†²æ³¡æ•°æ®</h2>
                    <div class="dashboard-grid">
                        <div class="chart-card">
                            <div class="chart-card-title">â˜• ç´¯è®¡å†²æ³¡</div>
                            <div class="chart-area" id="chart-method-donut"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-card-title">ğŸ“Š æœ¬å‘¨å†²æ³¡è¶‹åŠ¿</div>
                            <div class="chart-area" id="chart-weekly-bar"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-card-title">â­ è¯„åˆ†åˆ†å¸ƒ</div>
                            <div class="chart-area" id="chart-rating-bars"></div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="quick-action" data-page="timer">
                        <div class="quick-action-icon">â±ï¸</div>
                        <div class="quick-action-text">
                            <h4>å¼€å§‹å†²æ³¡</h4>
                            <p>ä½¿ç”¨è®¡æ—¶å™¨è®°å½•å†²æ³¡</p>
                        </div>
                    </button>
                    <button class="quick-action" id="btn-add-record">
                        <div class="quick-action-icon">â•</div>
                        <div class="quick-action-text">
                            <h4>æ·»åŠ è®°å½•</h4>
                            <p>æ‰‹åŠ¨è®°å½•å’–å•¡</p>
                        </div>
                    </button>
                    <button class="quick-action" data-page="recommendations">
                        <div class="quick-action-icon">ğŸ’¡</div>
                        <div class="quick-action-text">
                            <h4>æ¨èå‚æ•°</h4>
                            <p>æŸ¥çœ‹å†²æ³¡å»ºè®®</p>
                        </div>
                    </button>
                </div>

                <div class="records-header">
                    <h2 class="page-title" style="font-size: 22px;">æœ€è¿‘è®°å½•</h2>
                    <button class="btn btn-outline" data-page="records">æŸ¥çœ‹å…¨éƒ¨</button>
                </div>
                <div class="records-list" id="recent-records"></div>
            </div>

            <div class="page" id="page-recommendations">
                <div class="page-header">
                    <h1 class="page-title">æ¨èå‚æ•°</h1>
                    <p class="page-subtitle">å„æ–¹æ³•çš„æœ€ä½³å†²æ³¡å‚æ•°</p>
                </div>
                <div id="rec-grid"></div>
            </div>

            <div class="page" id="page-timer">
                <div class="page-header">
                    <h1 class="page-title">å†²æ³¡è®¡æ—¶å™¨</h1>
                    <p class="page-subtitle" id="timer-method-name">æ‰‹å†²å’–å•¡è®¡æ—¶</p>
                </div>

                <div class="recommended-params-toggle" onclick="toggleRecommendedPanel()">
                    <span>ğŸ’¡ é€‰æ‹©æ¨èé…æ–¹</span>
                    <span class="toggle-icon" id="toggle-icon">â–¼</span>
                </div>
                <div class="recommended-params-panel active" id="recommended-params-panel">
                    <div class="recipe-select-list" id="recipe-select-list"></div>
                </div>

                <div class="timer-container">
                    <div class="timer-display">
                        <div class="timer-circle">
                            <div class="timer-progress">
                                <svg viewBox="0 0 280 280">
                                    <circle cx="140" cy="140" r="130" />
                                </svg>
                            </div>
                            <div>
                                <div class="timer-time" id="timer-display">00:00</div>
                                <div class="timer-stage" id="timer-stage-display">å‡†å¤‡å¼€å§‹</div>
                            </div>
                        </div>
                    </div>

                    <div class="timer-controls">
                        <button class="btn btn-primary btn-lg" id="btn-start">
                            <span>â–¶</span> å¼€å§‹
                        </button>
                        <button class="btn btn-secondary btn-lg" id="btn-pause" style="display: none;">
                            <span>â¸</span> æš‚åœ
                        </button>
                        <button class="btn btn-outline btn-lg" id="btn-reset">
                            <span>â†º</span> é‡ç½®
                        </button>
                    </div>

                    <div class="timer-stages" id="timer-stages">
                        <div class="stage-item" data-stage="0">
                            <span class="stage-name">é€‰æ‹©æ–¹æ³•</span>
                            <span class="stage-time">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="page-records">
                <div class="page-header">
                    <h1 class="page-title">æˆ‘çš„è®°å½•</h1>
                    <p class="page-subtitle">å›é¡¾ä½ çš„å’–å•¡æ—…ç¨‹</p>
                </div>
                <div class="records-header">
                    <button class="btn btn-primary" id="btn-add-record-2">
                        <span>â•</span> æ·»åŠ è®°å½•
                    </button>
                </div>
                <div class="records-list" id="all-records"></div>
            </div>
        </main>

        <nav class="mobile-nav">
            <div class="mobile-nav-items">
                <button class="mobile-nav-item active" data-page="home">
                    <span class="nav-icon">ğŸ </span>
                    <span>é¦–é¡µ</span>
                </button>
                <button class="mobile-nav-item" data-page="timer">
                    <span class="nav-icon">â±ï¸</span>
                    <span>è®¡æ—¶</span>
                </button>
                <button class="mobile-nav-item" data-page="records">
                    <span class="nav-icon">ğŸ““</span>
                    <span>è®°å½•</span>
                </button>
            </div>
        </nav>
    </div>

    <div class="modal-overlay" id="record-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">æ·»åŠ è®°å½•</h3>
                <button class="modal-close" id="btn-close-modal">Ã—</button>
            </div>
            <form id="record-form">
                <input type="hidden" id="record-id">
                
                <div class="form-group">
                    <label class="form-label">å†²æ³¡æ–¹æ³•</label>
                    <select class="form-select" id="form-method-select">
                        <option value="pour-over">â˜• æ‰‹å†²</option>
                        <option value="french-press">ğŸ«– æ³•å‹å£¶</option>
                        <option value="aeropress">ğŸ’¨ çˆ±ä¹å‹</option>
                        <option value="clever">ğŸ§  èªæ˜æ¯</option>
                        <option value="cold-brew">ğŸ§Š å†·èƒ</option>
                        <option value="siphon">âš—ï¸ è™¹å¸å£¶</option>
                    </select>
                </div>

                <div class="form-row form-row-3">
                    <div class="form-group">
                        <label class="form-label">ç²‰é‡ (g)</label>
                        <input type="number" class="form-input" id="form-dose" placeholder="20" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ°´é‡ (ml)</label>
                        <input type="number" class="form-input" id="form-water" placeholder="300" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ°´æ¸© (Â°C)</label>
                        <input type="number" class="form-input" id="form-temp" placeholder="92" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ç ”ç£¨åº¦</label>
                        <select class="form-select" id="form-grind">
                            <option value="æç»†">æç»†</option>
                            <option value="ç»†">ç»†</option>
                            <option value="ä¸­ç»†">ä¸­ç»†</option>
                            <option value="ä¸­" selected>ä¸­</option>
                            <option value="ä¸­ç²—">ä¸­ç²—</option>
                            <option value="ç²—">ç²—</option>
                            <option value="æç²—">æç²—</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å’–å•¡çƒ˜ç„™åº¦</label>
                        <select class="form-select" id="form-roast">
                            <option value="æµ…çƒ˜">æµ…çƒ˜</option>
                            <option value="æµ…ä¸­çƒ˜">æµ…ä¸­çƒ˜</option>
                            <option value="ä¸­çƒ˜" selected>ä¸­çƒ˜</option>
                            <option value="ä¸­æ·±çƒ˜">ä¸­æ·±çƒ˜</option>
                            <option value="æ·±çƒ˜">æ·±çƒ˜</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å†²æ³¡æ—¶é•¿ (ç§’)</label>
                    <input type="number" class="form-input" id="form-time" placeholder="180">
                </div>

                <div class="form-group">
                    <label class="form-label">å†²æ³¡é˜¶æ®µ (å¯é€‰)</label>
                    <div class="record-stages-editor" id="record-stages-editor">
                        <div class="record-stages-list" id="record-stages-list"></div>
                        <button type="button" class="add-stage-btn" id="btn-add-record-stage">â• æ·»åŠ é˜¶æ®µ</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å’–å•¡è±†åç§°</label>
                    <input type="text" class="form-input" id="form-coffee-name" placeholder="è€¶åŠ é›ªè²">
                </div>

                <div class="form-group">
                    <label class="form-label">å£æ„Ÿè¯„åˆ†</label>
                    <div class="rating" id="form-rating">
                        <span class="rating-star" data-value="1">â˜…</span>
                        <span class="rating-star" data-value="2">â˜…</span>
                        <span class="rating-star" data-value="3">â˜…</span>
                        <span class="rating-star" data-value="4">â˜…</span>
                        <span class="rating-star" data-value="5">â˜…</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å£æ„Ÿæè¿°</label>
                    <textarea class="form-textarea" id="form-notes" placeholder="æè¿°è¿™æ¬¾å’–å•¡çš„å£æ„Ÿç‰¹ç‚¹..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">ä¸Šä¼ å›¾ç‰‡</label>
                    <div class="image-upload" id="image-upload">
                        <div class="image-upload-icon">ğŸ“·</div>
                        <div class="image-upload-text">ç‚¹å‡»ä¸Šä¼ å’–å•¡å›¾ç‰‡</div>
                    </div>
                    <input type="file" id="form-image" accept="image/*" style="display: none;">
                    <div class="image-preview" id="image-preview" style="display: none;">
                        <img id="preview-img" src="" alt="Preview">
                        <button type="button" class="image-preview-remove" id="btn-remove-image">Ã—</button>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn btn-outline" id="btn-cancel" style="flex: 1;">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <div class="recipe-preview-modal" id="recipe-preview-modal">
        <div class="recipe-preview">
            <div class="recipe-preview-header">
                <button class="recipe-preview-close" id="btn-close-recipe">Ã—</button>
                <div class="recipe-preview-title" id="preview-title">Recipe Name</div>
                <div class="recipe-preview-source" id="preview-source">Source</div>
            </div>
            <div class="recipe-preview-body">
                <div class="recipe-preview-params" id="preview-params"></div>
                <div class="recipe-preview-tips" id="preview-tips-section">
                    <div class="recipe-preview-tips-title">ğŸ’¡ å†²æ³¡å°è´´å£«</div>
                    <div class="recipe-preview-tips-text" id="preview-tips-text"></div>
                </div>
                <div class="recipe-preview-stages">
                    <div class="recipe-preview-stages-title">â±ï¸ å†²æ³¡é˜¶æ®µ</div>
                    <div id="preview-stages"></div>
                </div>
                <div class="recipe-preview-actions">
                    <button class="btn btn-primary" id="preview-start-btn">
                        <span>â±ï¸</span> å¼€å§‹å†²æ³¡
                    </button>
                    <a href="#" target="_blank" class="btn btn-outline" id="preview-source-btn">
                        ğŸ”— æŸ¥çœ‹åŸæ–‡
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="record-detail-modal" id="record-detail-modal">
        <div class="record-detail">
            <div class="record-detail-header">
                <button class="record-detail-close" id="btn-close-detail">Ã—</button>
                <div class="record-detail-method">
                    <span id="detail-method-icon">â˜•</span>
                    <span id="detail-method-name">æ‰‹å†²</span>
                </div>
                <div class="record-detail-coffee" id="detail-coffee"></div>
                <div class="record-detail-date" id="detail-date">2024å¹´1æœˆ1æ—¥</div>
            </div>
            <div class="record-detail-body">
                <div class="record-detail-section">
                    <div class="record-detail-section-title">ğŸ“Š å†²æ³¡å‚æ•°</div>
                    <div class="record-detail-params" id="detail-params"></div>
                </div>
                
                <div class="record-detail-section" id="detail-stages-section">
                    <div class="record-detail-section-title">â±ï¸ å†²æ³¡é˜¶æ®µ</div>
                    <div class="record-detail-stages" id="detail-stages"></div>
                </div>
                
                <div class="record-detail-section" id="detail-notes-section">
                    <div class="record-detail-section-title">ğŸ“ å£æ„Ÿæè¿°</div>
                    <div class="record-detail-notes" id="detail-notes"></div>
                </div>
                
                <div class="record-detail-actions">
                    <button class="btn btn-primary" id="btn-replay-timer">
                        <span>â±ï¸</span> ç”¨æ­¤å‚æ•°å†²æ³¡
                    </button>
                    <button class="btn btn-outline" id="btn-edit-record">
                        <span>âœï¸</span> ç¼–è¾‘è®°å½•
                    </button>
                    <button class="btn btn-outline" id="btn-save-as-recipe">
                        <span>ğŸ’¾</span> ä¿å­˜ä¸ºé…æ–¹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="save-recipe-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="save-recipe-title">ä¿å­˜ä¸ºé…æ–¹</h3>
                <button class="modal-close" id="btn-close-save-recipe">Ã—</button>
            </div>
            <form id="save-recipe-form">
                <input type="hidden" id="save-recipe-from-record">
                <div class="form-group">
                    <label class="form-label">é…æ–¹åç§°</label>
                    <input type="text" class="form-input" id="recipe-name" placeholder="æˆ‘çš„ç‹¬å®¶é…æ–¹" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å†²æ³¡æ–¹æ³•</label>
                    <select class="form-select" id="recipe-method">
                        <option value="pour-over">â˜• æ‰‹å†²</option>
                        <option value="french-press">ğŸ«– æ³•å‹å£¶</option>
                        <option value="aeropress">ğŸ’¨ çˆ±ä¹å‹</option>
                        <option value="clever">ğŸ§  èªæ˜æ¯</option>
                        <option value="cold-brew">ğŸ§Š å†·èƒ</option>
                        <option value="siphon">âš—ï¸ è™¹å¸å£¶</option>
                    </select>
                </div>
                <div class="form-row form-row-3">
                    <div class="form-group">
                        <label class="form-label">ç²‰é‡ (g)</label>
                        <input type="number" class="form-input" id="recipe-dose" placeholder="20" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ°´é‡ (ml)</label>
                        <input type="number" class="form-input" id="recipe-water" placeholder="300" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ°´æ¸© (Â°C)</label>
                        <input type="number" class="form-input" id="recipe-temp" placeholder="92" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ç ”ç£¨åº¦</label>
                    <select class="form-select" id="recipe-grind">
                        <option value="æç»†">æç»†</option>
                        <option value="ç»†">ç»†</option>
                        <option value="ä¸­ç»†">ä¸­ç»†</option>
                        <option value="ä¸­" selected>ä¸­</option>
                        <option value="ä¸­ç²—">ä¸­ç²—</option>
                        <option value="ç²—">ç²—</option>
                        <option value="æç²—">æç²—</option>
                    </select>
                </div>
                <div class="stages-editor">
                    <div class="stages-editor-title">â±ï¸ å†²æ³¡é˜¶æ®µ</div>
                    <div class="stages-editor-list" id="recipe-stages-list"></div>
                    <button type="button" class="add-stage-btn" id="btn-add-recipe-stage">â• æ·»åŠ é˜¶æ®µ</button>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn btn-outline" id="btn-cancel-save-recipe" style="flex: 1;">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ä¿å­˜é…æ–¹</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="notion-config-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">âš™ï¸ Notion é…ç½®</h3>
                <button class="modal-close" id="btn-close-config">Ã—</button>
            </div>
            <div class="notion-config-body">
                <div class="config-section">
                    <h4>ç¬¬ä¸€æ­¥ï¼šè·å– API Key</h4>
                    <ol class="config-steps">
                        <li>æ‰“å¼€ <a href="https://www.notion.so/my-integrations" target="_blank">Notion Integrations</a></li>
                        <li>ç‚¹å‡» <strong>Internal integrations</strong> æ ‡ç­¾</li>
                        <li>ç‚¹å‡» <strong>New integration</strong></li>
                        <li>å¡«å†™åç§° "Coffee Brew"ï¼Œç‚¹å‡» Save</li>
                        <li>å¤åˆ¶ <strong>Internal Integration Token</strong></li>
                    </ol>
                </div>
                
                <div class="config-section">
                    <h4>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“</h4>
                    <ol class="config-steps">
                        <li>åœ¨ Notion æ–°å»ºé¡µé¢ï¼Œè¾“å…¥ <code>/database</code></li>
                        <li>é€‰æ‹© <strong>Table - Full page</strong></li>
                        <li>æ·»åŠ ä»¥ä¸‹å±æ€§åˆ—ï¼š</li>
                    </ol>
                    <table class="config-table">
                        <tr><th>åˆ—å</th><th>ç±»å‹</th></tr>
                        <tr><td>å’–å•¡è±†</td><td>Title</td></tr>
                        <tr><td>æ—¥æœŸ</td><td>Date</td></tr>
                        <tr><td>å†²æ³¡æ–¹æ³•</td><td>Select</td></tr>
                        <tr><td>ç²‰é‡</td><td>Number</td></tr>
                        <tr><td>æ°´é‡</td><td>Number</td></tr>
                        <tr><td>æ°´æ¸©</td><td>Number</td></tr>
                        <tr><td>ç ”ç£¨åº¦</td><td>Select</td></tr>
                        <tr><td>çƒ˜ç„™åº¦</td><td>Select</td></tr>
                        <tr><td>æ—¶é•¿</td><td>Number</td></tr>
                        <tr><td>è¯„åˆ†</td><td>Select</td></tr>
                        <tr><td>å£æ„Ÿæè¿°</td><td>Text</td></tr>
                    </table>
                    <ol class="config-steps" start="4">
                        <li>ç‚¹å‡»å³ä¸Šè§’ <strong>...</strong> â†’ <strong>Connect to</strong> â†’ é€‰æ‹© "Coffee Brew"</li>
                        <li>å¤åˆ¶æ•°æ®åº“ URLï¼Œè·å– IDï¼ˆURL ä¸­ ? å‰çš„éƒ¨åˆ†ï¼‰</li>
                    </ol>
                </div>
                
                <div class="config-section">
                    <h4>ç¬¬ä¸‰æ­¥ï¼šå¡«å†™é…ç½®</h4>
                    <div class="form-group">
                        <label class="form-label">API Key (Token)</label>
                        <input type="password" class="form-input" id="config-api-key" placeholder="secret_xxxx...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ•°æ®åº“ ID (Database ID)</label>
                        <input type="text" class="form-input" id="config-database-id" placeholder="30e0d244141e8...">
                    </div>
                    <button class="btn btn-primary" id="btn-save-config" style="width: 100%;">ä¿å­˜é…ç½®</button>
                    <div id="config-status" class="config-status"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">ä¿å­˜æˆåŠŸ</div>

    <script src="js/notion-sync.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.initNotionSync();
            
            document.getElementById('btn-add-record')?.addEventListener('click', function() {
                window.openRecordModal();
            });
            document.getElementById('btn-add-record-2')?.addEventListener('click', function() {
                window.openRecordModal();
            });
            document.getElementById('btn-close-modal')?.addEventListener('click', function() {
                window.closeRecordModal();
            });
            document.getElementById('btn-cancel')?.addEventListener('click', function() {
                window.closeRecordModal();
            });
            document.getElementById('image-upload')?.addEventListener('click', function() {
                document.getElementById('form-image')?.click();
            });
            document.getElementById('form-image')?.addEventListener('change', function(e) {
                window.handleImageUpload?.(e);
            });
            document.getElementById('btn-remove-image')?.addEventListener('click', function() {
                window.removeImage?.();
            });
            document.getElementById('record-form')?.addEventListener('submit', function(e) {
                window.saveRecord?.(e);
            });
            document.getElementById('btn-close-recipe')?.addEventListener('click', function() {
                window.closeRecipePreview?.();
            });
            document.getElementById('recipe-preview-modal')?.addEventListener('click', function(e) {
                if (e.target === this) window.closeRecipePreview?.();
            });
            document.getElementById('preview-start-btn')?.addEventListener('click', function() {
                window.closeRecipePreview?.();
            });
            document.getElementById('btn-close-detail')?.addEventListener('click', function() {
                window.closeRecordDetail?.();
            });
            document.getElementById('record-detail-modal')?.addEventListener('click', function(e) {
                if (e.target === this) window.closeRecordDetail?.();
            });
            document.getElementById('btn-replay-timer')?.addEventListener('click', function() {
                window.replayTimerFromRecord?.();
            });
            document.getElementById('btn-edit-record')?.addEventListener('click', function() {
                window.editRecordFromDetail?.();
            });
            document.getElementById('form-method-select')?.addEventListener('change', function() {
                window.handleRecordMethodChange?.();
            });
            document.getElementById('btn-add-record-stage')?.addEventListener('click', function() {
                window.addRecordStage?.();
            });
            document.getElementById('btn-start')?.addEventListener('click', function() {
                window.startTimer?.();
            });
            document.getElementById('btn-pause')?.addEventListener('click', function() {
                window.pauseTimer?.();
            });
            document.getElementById('btn-reset')?.addEventListener('click', function() {
                window.resetTimer?.();
            });
            document.getElementById('btn-add-stage')?.addEventListener('click', function() {
                window.addStage?.();
            });
            document.querySelectorAll('.quick-action').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var page = this.getAttribute('data-page');
                    if (page) window.navigateTo?.(page);
                });
            });
            document.querySelectorAll('.btn-outline[data-page]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var page = this.getAttribute('data-page');
                    if (page) window.navigateTo?.(page);
                });
            });
        });
    </script>
</body>
</html>
